# Story 4.1.12: MultiStep Form Step 2 Implementation

**Status:** Draft  
**Priority:** High  
**Estimated Effort:** 3-4 hours  
**Dependencies:** Story 4.1.11 (Step 1 Implementation) - TO BE COMPLETED

## Story

**As a** sustainability reporting user,  
**I want** to add the second step for Strategy & Governance to the existing single-step form,  
**so that** I can provide strategic sustainability information in a properly validated multi-step experience with seamless navigation between steps.

## Story Context

**Strategic Approach:**
- Second incremental implementation building on Step 1
- Adds multi-step navigation functionality
- Continues TDD approach with test-first development
- Tests step transitions and data persistence across steps

**Implementation Strategy:**
- Extend Step 1 implementation to include Step 2
- Add navigation between steps with validation
- Ensure data persists across step navigation
- Full test coverage for multi-step behavior

## Acceptance Criteria

1. GeneralInfo form now includes both Step 1 (Company Info) AND Step 2 (Strategy & Governance)
2. Step 2 includes strategy fields: sustainability strategy, governance structure, risk management
3. Navigation controls allow movement between Step 1 and Step 2
4. Step 1 validation must pass before proceeding to Step 2
5. Form data persists across step navigation with key `form-general-info`
6. Progress indicator shows current step (1 of 2 or 2 of 2)
7. Back navigation from Step 2 to Step 1 preserves all entered data
8. Tests written BEFORE implementation for Step 2 functionality
9. All tests pass for multi-step navigation and validation
10. TypeScript compilation passes with extended types

## Tasks / Subtasks

- [ ] **Task 1: Write Tests for Step 2 (TDD)** (AC: 8)
  - [ ] Create tests for Step 2 field rendering
  - [ ] Write tests for Step 2 validation rules
  - [ ] Write tests for step navigation forward/back
  - [ ] Write tests for validation blocking navigation
  - [ ] Write tests for data persistence across steps
  - [ ] Verify tests fail initially (Red phase)

- [ ] **Task 2: Extend Form Configuration for Step 2** (AC: 1, 2, 3)
  - [ ] Update GeneralInfoData interface to include Step 2 fields
  - [ ] Create Zod schema for strategy & governance fields
  - [ ] Update form configuration to include Step 2
  - [ ] Configure step navigation rules

- [ ] **Task 3: Implement Multi-Step Navigation** (AC: 3, 4, 6, 7)
  - [ ] Enable NavigationControls in form configuration
  - [ ] Implement step validation before navigation
  - [ ] Add ProgressIndicator to show current step
  - [ ] Ensure back navigation preserves data

- [ ] **Task 4: Update Data Persistence** (AC: 5)
  - [ ] Update localStorage key to handle both steps
  - [ ] Ensure data saves on step navigation
  - [ ] Test restoration of multi-step data
  - [ ] Handle partial data scenarios

- [ ] **Task 5: Make All Tests Pass** (AC: 9, 10)
  - [ ] Fix implementation to pass Step 2 tests
  - [ ] Ensure navigation tests pass
  - [ ] Verify persistence tests pass
  - [ ] Confirm TypeScript compilation

- [ ] **Task 6: Integration Testing** (AC: 1, 9)
  - [ ] Test complete flow from Step 1 to Step 2
  - [ ] Verify all validations work correctly
  - [ ] Test edge cases in navigation
  - [ ] Ensure consistent user experience

## Dev Notes

### Previous Story Context (4.1.11 Completion)
- Step 1 successfully implemented with TDD approach
- Single step form with company information fields
- localStorage persistence established with `form-general-info-step1` key
- Test patterns established for form validation

### Form Configuration Updates
Extending existing configuration to add Step 2:
```typescript
interface GeneralInfoData {
  // Step 1 fields (existing)
  companyInfo: {
    name: string
    organizationNumber: string
    // ... other fields
  }
  // Step 2 fields (new)
  strategyGovernance: {
    sustainabilityStrategy: string
    governanceStructure: string
    riskManagement: string
  }
}
```

### Step 2 Fields Required
Strategy & Governance fields:
- Sustainability strategy description (textarea, required, min 100 chars)
- Governance structure and oversight (textarea, required, min 50 chars)
- Risk management approach (textarea, required, min 50 chars)
- Key sustainability initiatives (checkbox group, optional)
- Board oversight level (select, required)

### Navigation Implementation
Based on existing NavigationControls from Stories 4.1.8 & 4.1.9:
- Use existing NavigationControls component
- Implement canGoToNextStep validation logic
- Add ProgressIndicator component integration
- Handle step transition animations if configured

### File Updates Required
- Update: `apps/web/src/lib/forms/configs/general-info-config.ts` (rename from step1)
- Update: `apps/web/src/lib/forms/types/general-info-types.ts`
- Update: `apps/web/src/lib/forms/validation/general-info-schemas.ts`
- Update: `apps/web/src/app/(SignedIn)/generalinfo/page.tsx`
- Create: `apps/web/src/app/(SignedIn)/generalinfo/__tests__/step2.test.tsx`
- Update: `apps/web/src/app/(SignedIn)/generalinfo/__tests__/navigation.test.tsx`

### Testing Requirements

**Test File Locations:** 
- `apps/web/src/app/(SignedIn)/generalinfo/__tests__/step2.test.tsx` - Step 2 specific tests
- `apps/web/src/app/(SignedIn)/generalinfo/__tests__/navigation.test.tsx` - Multi-step navigation tests

**Test Standards:**
- Continue TDD approach from Step 1
- Test navigation logic thoroughly
- Mock step validation for navigation tests
- Test data persistence across steps
- Verify progress indicator updates

**Additional Test Cases:**
- Cannot proceed to Step 2 with invalid Step 1 data
- Can go back to Step 1 from Step 2
- Data persists when navigating between steps
- Progress indicator shows correct step number
- Form submission only available on last step

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-26 | 1.0 | Initial story creation - Second split from 4.1.10 for TDD | Bob (Scrum Master) |

## Dev Agent Record

*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled during implementation*

### Debug Log References
*To be filled during implementation*

### Completion Notes List
*To be filled during implementation*

### File List
*To be filled during implementation*

## QA Results

*QA review results will be documented here after implementation*
