# Story 1.2: Update Root Layout

## Status
Draft

## Story
**As a** developer,
**I want** to replace the existing AuthProvider with ClerkProvider in the root layout,
**so that** all pages receive Clerk-based context for authentication.

## Acceptance Criteria
1. The root layout file (e.g., apps/web/src/app/layout.tsx) is updated to import and use ClerkProvider instead of the existing AuthProvider.
2. ClerkProvider is configured with appropriate props for the app's domain and SSO settings to support the sister app.
3. All child components and pages have access to Clerk's authentication context without additional wrapping.
4. The app builds and runs without errors after the replacement.
5. Existing authentication flows continue to work seamlessly with the new provider.

## Tasks / Subtasks
- [ ] Locate and analyze current root layout
  - [ ] Identify existing AuthProvider implementation
  - [ ] Review current authentication context structure
- [ ] Update imports and provider replacement
  - [ ] Import ClerkProvider from @clerk/nextjs
  - [ ] Remove existing AuthProvider import
  - [ ] Replace provider wrapper in layout component
- [ ] Configure ClerkProvider properties
  - [ ] Set domain property for SSO support
  - [ ] Configure appearance and localization if needed
  - [ ] Ensure compatibility with existing theme providers
- [ ] Verify context availability
  - [ ] Test Clerk hooks in child components
  - [ ] Confirm authentication state propagation
  - [ ] Check middleware integration points
- [ ] Build and test application
  - [ ] Run build process to check for errors
  - [ ] Test authentication flows manually
  - [ ] Verify no breaking changes in existing components

## Dev Notes
**Relevant Architecture Information:**
- Next.js 14+ with App Router (from tech stack)
- Clerk authentication service integration (from architecture.md)
- SSO support for sister app on same domain
- Component hierarchy: ClerkProvider should wrap all authenticated routes
- Theme provider integration (from existing layout structure)

**Source Tree Information:**
- Root layout: apps/web/src/app/layout.tsx
- App directory structure: apps/web/src/app/
- Theme provider: apps/web/src/components/layout/theme-provider.tsx
- Existing auth provider location: To be identified during implementation

**Technical Context:**
- ClerkProvider must be at the highest level for global auth context
- Compatible with existing theme and layout providers
- Supports Next.js App Router structure
- Environment variables from Story 1.1 required
- No additional wrapping needed for child components

## Testing
**Relevant Testing Standards from Architecture:**
- ESLint for code quality (root .eslintrc.js)
- Prettier for code formatting (root prettier.config.js)
- TypeScript for type safety across monorepo
- Next.js build verification

**Testing Requirements for this Story:**
- Unit tests for layout component changes
- Integration tests for ClerkProvider configuration
- E2E tests for authentication context availability
- Build verification and error checking

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-03 | 1.0 | Initial story creation with template compliance | Sarah (PO) |

## Dev Agent Record
### Agent Model Used
*To be populated by development agent*

### Debug Log References
*To be populated by development agent*

### Completion Notes List
*To be populated by development agent*

### File List
*To be populated by development agent*

## QA Results
*To be populated by QA agent*