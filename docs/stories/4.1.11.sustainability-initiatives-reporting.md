# Story 4.1.11: Sustainability Initiatives Reporting

**Status:** Ready for Development  
**Priority:** Normal  
**Estimated Effort:** 6-8 hours  
**Dependencies:** Story 4.1.10 (GeneralInfo Page Integration) âœ… COMPLETED

## Story

**As a** sustainability reporting user,  
**I want** to report on the sustainability initiatives we are already involved in with detailed information about responsible persons, goals, and descriptions,  
**so that** I can communicate these efforts in my sustainability report and demonstrate our commitment to sustainable practices.

## Acceptance Criteria

1. **Initiative Selection Table:** Display a table with checkboxes for eight predefined sustainability initiatives: Workforce Development, Biodiversity, Climate Change, Business Ethics, Circular Economy, Community Impact, Marine Resources, and Stakeholder Engagement
2. **Add Initiative Functionality:** When a user clicks the "Add" button for an initiative, a form opens below the table allowing input of responsible person, goal, and description
3. **Initiative Confirmation:** After completing the form and confirming, the initiative is marked as checked in the table and the action column shows edit and delete icon buttons instead of the add button
4. **Edit Initiative:** Users can click the edit icon to modify existing initiative details, opening the same form with pre-populated data
5. **Delete Initiative:** Users can click the delete icon to remove an initiative, unchecking it in the table and reverting the action column to show the add button
6. **Data Persistence:** All initiative data is stored in an array structure that persists across page reloads and integrates with the existing form system
7. **Form Validation:** The initiative form validates that all fields (responsible person, goal, description) are completed before allowing confirmation
8. **UI Integration:** The component integrates seamlessly with existing form layouts and follows the established design patterns
9. **Accessibility:** The table and forms are fully accessible with proper ARIA labels and keyboard navigation support
10. **Type Safety:** All data structures and components have proper TypeScript typing with integration into existing form schemas
11. **Table Columns:** When the table of initiatives is rendered, it has the following columns: Checkmark, Initiative, Responsible, Actions

## Tasks / Subtasks

- [ ] **Task 1: Create Initiatives Data Structure and Types** (AC: 6, 10, 11)
  - [ ] Define TypeScript interfaces for initiative data structure with type, responsiblePerson, goal, and description fields
  - [ ] Create Zod validation schema for initiative data validation
  - [ ] Add initiatives array to existing form data types and schemas
  - [ ] Update form configuration to include initiatives step/section

- [ ] **Task 2: Create Initiative Selection Table Component** (AC: 1, 3, 8, 11)
  - [ ] Build table component with predefined initiative types as rows
  - [ ] Implement checkbox column for initiative selection status
  - [ ] Create action column with conditional rendering of Add/Edit/Delete buttons
  - [ ] Apply consistent styling with existing table components and design system
  - [ ] Integrate with react-hook-form for form state management

- [ ] **Task 3: Implement Initiative Form Component** (AC: 2, 4, 7)
  - [ ] Create form component for capturing initiative details (responsible person, goal, description)
  - [ ] Implement form validation using Zod schema integration
  - [ ] Add form confirmation and cancellation functionality
  - [ ] Support both add and edit modes with appropriate data pre-population
  - [ ] Integrate with existing form field components for consistency

- [ ] **Task 4: Implement Initiative Management Logic** (AC: 3, 5, 6)
  - [ ] Create functions for adding, editing, and deleting initiatives
  - [ ] Implement array management for storing initiative data
  - [ ] Add state management for tracking which initiative is being edited
  - [ ] Ensure proper data persistence through existing form storage mechanisms
  - [ ] Handle edge cases and error scenarios

- [ ] **Task 5: Accessibility and Integration Testing** (AC: 8, 9, 10)
  - [ ] Implement proper ARIA labels and roles for table and form elements
  - [ ] Add keyboard navigation support for table interactions
  - [ ] Test screen reader compatibility and focus management
  - [ ] Verify integration with existing form validation and submission flow
  - [ ] Validate TypeScript compilation and type safety across all components

## Dev Notes

### Previous Story Context

**Key Learnings from GeneralInfo Integration (Story 4.1.10):**
- MultiStepForm system is fully operational with React hook forms, Zod validation, and localStorage persistence
- Form configuration pattern is established with step-based organization and field registry
- Storage integration can use debounced auto-save with automatic restoration on mount
- Navigation controls and progress indication provide consistent UX patterns

### Data Structure Requirements

**Initiative Data Model:** [Source: User Requirements]
```typescript
interface SustainabilityInitiative {
  type: 'Workforce Development' | 'Biodiversity' | 'Climate Change' | 'Business Ethics' | 'Circular Economy' | 'Community Impact' | 'Marine Resources' | 'Stakeholder Engagement'
  responsiblePerson: string
  goal: string
  description: string
  isSelected: boolean
}

interface SustainabilityData {
  initiatives: SustainabilityInitiative[]
}
```

**Predefined Initiative Types:** [Source: User Requirements]
- Workforce Development
- Biodiversity  
- Climate Change
- Business Ethics
- Circular Economy
- Community Impact
- Marine Resources
- Stakeholder Engagement

### Component Architecture [Source: Form Implementation Patterns documentation]

**Table Component Pattern:**
- Use Card-based UI pattern for professional presentation
- Use shadcn table and Tanstack table if needed
- Implement checkbox selection in first column for visual status(disabled)
- Action column with conditional button rendering (Add vs Edit/Delete)
- Consistent styling with existing table components and design system

**Form Component Pattern:**
- Leverage existing form field components from field registry
- Integrate with react-hook-form Controller for consistent state management
- Apply Zod validation schema for proper validation feedback
- Support both add and edit modes with appropriate data handling

**Business Entity Collection Management:** [Source: Memory - Business Entity Collection Management Pattern]
- Use Card-based UI pattern for each initiative entry with clear management controls
- Include validation before adding new initiatives to ensure data quality
- Display initiative information with type on first line and details below
- Use small icon buttons (pencil for edit, trash for delete) for management actions
- Ensure proper integration with form validation systems and schema validation

### Technical Implementation Details

**Form Integration:** [Source: MultiStepForm implementation]
- Extend existing form configuration with initiatives step/section
- Use FieldArray pattern for managing dynamic initiative collection
- Integrate with existing localStorage persistence mechanism with consistent storage key
- Follow established validation patterns with step-level and field-level validation

**UI Component Specifications:** [Source: shadcn/ui integration patterns]
- Table component: Use existing Table components from shadcn/ui library
- Form fields: Shadcn/ui library for form fields
- Buttons: Use Button component with appropriate variants (outline for Add, ghost for Edit/Delete)
- Icons: Use Lucide icons (Plus for Add, Pencil for Edit, Trash2 for Delete)

**State Management Pattern:** [Source: Form Implementation Patterns]
- Use react-hook-form's useFieldArray for managing initiatives array
- Implement local state for tracking which initiative is being edited
- Apply proper memoization for performance optimization
- Follow established patterns for conditional rendering and form state

### File Locations [Source: docs/architecture-breakdown/03-repository-structure.md]

**Files to Create:**
- `apps/web/src/components/forms/sustainability/InitiativesTable.tsx` - Main table component
- `apps/web/src/components/forms/sustainability/InitiativeForm.tsx` - Form component for initiative details
- `apps/web/src/components/forms/sustainability/InitiativeManager.tsx` - Container component integrating table and form
- `apps/web/src/lib/forms/types/sustainability-types.ts` - TypeScript interfaces for initiative data
- `apps/web/src/lib/forms/validation/sustainability-schemas.ts` - Zod validation schemas

**Files to Update:**
- Existing form configuration files to include sustainability initiatives step
- Form type definitions to include SustainabilityData interface
- Main form schemas to incorporate initiative validation

### Integration Requirements

**Form System Integration:** [Source: MultiStepForm architecture]
- Must integrate with existing MultiStepForm controller and configuration system
- Follow established patterns for field registration and validation
- Maintain compatibility with existing form persistence and restoration mechanisms
- Ensure consistent user experience with existing form steps and navigation

**Performance Considerations:**
- Component rendering optimization with proper memoization
- Efficient array operations for initiative management
- Proper cleanup of form state and event listeners
- Minimal re-renders during form interactions

### Validation Rules [Source: Form validation patterns]

**Initiative Form Validation:**
- Responsible Person: Required, minimum 2 characters
- Goal: Required, minimum 10 characters for meaningful goal description
- Description: Required, minimum 20 characters for comprehensive description
- Initiative Type: All optional, must be one of predefined types

**Array Validation:**
- Maximum of 8 initiatives (one per type)
- No duplicate initiative types allowed
- No initiatives are required. Form can be submitted without any initiatives.

### Technical Constraints

**Existing Infrastructure Compatibility:**
- Must work with current Next.js App Router structure and existing form routing
- Integrate with existing authentication context and user session management
- Follow established responsive design principles and component composition patterns
- Maintain compatibility with existing TypeScript configuration and type system

**Accessibility Requirements:** [Source: WCAG 2.1 AA compliance]
- Table must have proper table headers and caption
- Form controls must have associated labels and error messaging
- Keyboard navigation support for all interactive elements
- Screen reader compatibility with appropriate ARIA attributes
- Focus management during form operations and modal interactions

**Security Considerations:**
- Input sanitization for user-provided text fields
- XSS prevention in dynamically rendered content
- Proper validation of form data before submission
- Integration with existing data handling and storage security patterns

## Testing

### Test File Locations
- `apps/web/src/components/forms/sustainability/__tests__/InitiativesTable.test.tsx` - Table component tests
- `apps/web/src/components/forms/sustainability/__tests__/InitiativeForm.test.tsx` - Form component tests  
- `apps/web/src/components/forms/sustainability/__tests__/InitiativeManager.test.tsx` - Integration tests
- `apps/web/src/lib/forms/validation/__tests__/sustainability-schemas.test.ts` - Schema validation tests

### Test Coverage Requirements
- Unit tests for all component interactions (add, edit, delete initiatives)
- Form validation testing with various input scenarios
- Integration tests with existing form system and persistence
- Accessibility testing with screen reader simulation
- TypeScript compilation and type safety validation
- Edge case testing:
  - Attempting to add duplicate initiatives
  - Form validation error scenarios
  - Keyboard navigation flows
  - Empty state handling
  - Data persistence across page reloads

### Test Methodology
- TDD approach with RED-GREEN-REFACTOR cycles
- Component testing with Vitest and React Testing Library
- Integration testing with existing form system
- Accessibility testing with screen reader simulation

### Risk-based Test Prioritization
- **P0 (Critical):** Data persistence, form validation, basic functionality
- **P1 (High):** UI integration, accessibility, type safety
- **P2 (Medium):** Edge cases, error handling, performance

### Success Criteria
- All P0 tests passing with 100% coverage
- All P1 tests passing with >95% coverage
- QA gate decision: PASS
- Code review approval

## QA Results

### Requirements Traceability Mapping

#### Acceptance Criteria 1: Initiative Selection Table
**Given** a user accesses the sustainability initiatives reporting section/step
**When** the page/step loads
**Then** a table is displayed with checkboxes for eight predefined sustainability initiatives

#### Acceptance Criteria 2: Add Initiative Functionality
**Given** a user is viewing the initiatives table
**When** they click the "Add" button for an initiative
**Then** a form opens below the table allowing input of responsible person, goal, and description

#### Acceptance Criteria 3: Initiative Confirmation
**Given** a user has filled out the initiative form
**When** they confirm the form
**Then** the initiative is marked as checked in the table and the action column shows edit and delete buttons instead of the add button

#### Acceptance Criteria 4: Edit Initiative
**Given** a user has added an initiative
**When** they click the edit icon for that initiative
**Then** the same form opens with pre-populated data for that initiative

#### Acceptance Criteria 5: Delete Initiative
**Given** a user has added an initiative
**When** they click the delete icon for that initiative
**Then** the initiative is removed, unchecked in the table, and the action column reverts to show the add button

#### Acceptance Criteria 6: Data Persistence
**Given** a user has added or modified initiatives
**When** they reload the page
**Then** all initiative data is preserved in the array structure and displayed correctly

#### Acceptance Criteria 7: Form Validation
**Given** a user is filling out the initiative form
**When** they leave required fields empty or enter invalid data
**Then** appropriate validation errors are displayed and confirmation is prevented

#### Acceptance Criteria 8: UI Integration
**Given** a user is using the sustainability initiatives component
**When** they interact with the table and forms
**Then** the UI integrates seamlessly with existing form layouts and follows established design patterns

#### Acceptance Criteria 9: Accessibility
**Given** a user is navigating with keyboard or screen reader
**When** they interact with the table and forms
**Then** all elements have proper ARIA labels and keyboard navigation support

#### Acceptance Criteria 10: Type Safety
**Given** the TypeScript compiler is running
**When** the initiative components and types are compiled
**Then** no type errors occur and all data structures have proper typing

#### Acceptance Criteria 11: Table Columns
**Given** the initiative is saved
**When** the table of initiatives is rendered
**Then** the table has the following columns: Checkmark, Initiative, Responsible, Actions

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-29 | 1.0 | Initial story creation with comprehensive requirements and technical context | Bob (Scrum Master) |
| 2025-08-29 | 1.1 | QA review and updates for development readiness | Quinn (Test Architect) |