# Story 4.1.10: GeneralInfo Page Integration

**Status:** Draft  
**Priority:** Normal  
**Estimated Effort:** 4-6 hours  
**Dependencies:** Story 4.1.8 (MultiStepForm Controller) ✅ COMPLETED, Story 4.1.9 (Step Renderer Configuration) ✅ COMPLETED

## Story

**As a** sustainability reporting user,  
**I want** the GeneralInfo page to use the new MultiStepForm system with proper configuration,  
**so that** I can efficiently complete the general information section of my sustainability report through a guided, validated, multi-step experience.

## Story Context

**Existing System Integration:**

- **Built upon:** Story 4.1.8's MultiStepForm controller and Story 4.1.9's StepRenderer system (both completed)
- **Technology:** Next.js 15, React 19, TanStack Forms, Zod validation, existing shadcn/ui components
- **Integration points:** Current GeneralInfo page (`/app/(SignedIn)/generalinfo/page.tsx`), form configuration system, localStorage persistence
- **Current status:** GeneralInfo page exists with placeholder content and EnvironmentModuleForm component

**Enhancement Details:**

- **What's being added:** Complete integration of MultiStepForm system into GeneralInfo page
- **How it integrates:** Replaces current placeholder content with configured MultiStepForm component
- **Pattern followed:** Form configuration with sustainability reporting fields, step-based navigation, data persistence

## Acceptance Criteria

1. GeneralInfo page renders MultiStepForm with proper configuration for general information collection
2. Form configuration includes all required steps: Company Information, Strategy & Goals, and Business Context
3. Form fields map correctly to sustainability reporting requirements from architecture documentation
4. Form data persists automatically to localStorage with restoration on page reload
5. Step validation prevents navigation until current step requirements are met
6. Existing page layout and navigation remain unchanged (maintains current responsive design)
7. Form integrates seamlessly with existing authentication context and user session
8. Storage system uses consistent naming convention for form identification
9. Error handling displays appropriate user feedback for validation failures
10. TypeScript compilation passes with full type safety for form configuration
11. Component follows existing accessibility patterns and WCAG 2.1 AA compliance
12. Form performance remains optimal with efficient re-rendering and validation

## Tasks / Subtasks

- [ ] **Task 1: Create GeneralInfo Form Configuration** (AC: 1, 2, 3)
  - [ ] Define GeneralInfo form configuration with 3 steps: Company Info, Strategy, Business Context
  - [ ] Create Zod validation schemas for each step based on sustainability reporting requirements
  - [ ] Map field definitions to existing form field components from field registry
  - [ ] Configure form persistence settings with appropriate storage key

- [ ] **Task 2: Update GeneralInfo Page Component** (AC: 6, 8)
  - [ ] Replace current placeholder content with MultiStepForm integration
  - [ ] Maintain existing page layout structure and responsive design
  - [ ] Ensure proper props passing and form configuration setup
  - [ ] Add proper TypeScript types for GeneralInfo form data

- [ ] **Task 3: Implement Form Data Integration** (AC: 4, 5, 9)
  - [ ] Configure automatic localStorage persistence with `form-general-info` key
  - [ ] Add form state restoration functionality on page load
  - [ ] Implement step-level validation with user feedback
  - [ ] Add error boundary handling for form configuration issues

- [ ] **Task 4: Test Integration and Accessibility** (AC: 10, 11, 12)
  - [ ] Verify TypeScript compilation with form configuration types
  - [ ] Test accessibility compliance with screen reader navigation
  - [ ] Validate form performance with step navigation and validation
  - [ ] Ensure responsive design works across device sizes

## Dev Notes

### Previous Story Context (Stories 4.1.8 & 4.1.9)

**Key Learnings from Story Implementation:**
- MultiStepForm controller is fully implemented with TanStack Forms, Zod validation, and localStorage persistence
- StepRenderer system dynamically renders fields based on configuration with full type safety
- Form registry system supports all existing field types: text, textarea, select, checkbox, fieldArray, conditionalGroup
- Storage integration uses debounced auto-save (500ms) with automatic restoration on mount
- Form follows established patterns for navigation controls and progress indication

**Integration Points Confirmed:**
- MultiStepForm component available at `/components/forms/multi-step/MultiStepForm.tsx`
- StepRenderer handles dynamic field rendering with validation integration
- NavigationControls and ProgressIndicator provide consistent UI experience
- LocalStorageProvider handles persistence with configurable storage keys

### Current GeneralInfo Page Analysis

**Current Implementation:** [Source: apps/web/src/app/(SignedIn)/generalinfo/page.tsx]
- Basic page layout with placeholder content and grid structure
- Existing EnvironmentModuleForm component (will be replaced)
- Responsive design with proper spacing and muted background styling
- Integration point: Replace content in main container while preserving layout

**Page Structure to Maintain:**
- Outer container: `flex flex-1 flex-col gap-4 p-4 pt-0`
- Header section with title and description
- Main content area with `min-h-[100vh] flex-1 rounded-xl bg-muted/50 md:min-h-min`

### Sustainability Reporting Requirements [Source: Architecture documents]

**General Information Module Requirements:**
- **Company Information:** Basic company details, registration info, reporting period
- **Strategy & Governance:** Sustainability strategy, governance structure, risk management
- **Business Context:** Business model, value chain, stakeholder engagement

**Field Types Required:**
- Text inputs: Company name, registration number, address fields
- Select dropdowns: Industry sector, company size, reporting period
- Textarea fields: Strategy description, business model description
- Checkbox groups: Reporting frameworks used, materiality assessment approaches

### Form Configuration Structure [Source: MultiStepForm implementation patterns]

**Step 1: Company Information**
- Company basic details (name, registration, address)
- Reporting period selection and scope
- Industry and size classification

**Step 2: Strategy & Governance**  
- Sustainability strategy description
- Governance structure and oversight
- Risk management approach

**Step 3: Business Context**
- Business model and value chain description
- Stakeholder engagement process
- Materiality assessment methodology

### Technical Implementation Details [Source: Stories 4.1.8 & 4.1.9 completion]

**MultiStepFormConfig Structure:**
```typescript
interface MultiStepFormConfig<T> {
  id: string
  title: string
  steps: FormStep<T>[]
  onSubmit: (data: T) => Promise<void>
  storage?: StorageProvider
  onSave?: (data: Partial<T>) => Promise<void>
}
```

**Form Data Types Required:**
- GeneralInfoData interface with step-specific data structures
- Zod validation schemas for each step
- Field definitions mapped to existing field registry components

### File Locations [Source: docs/architecture-breakdown/03-repository-structure.md]

**Files to Create:**
- `apps/web/src/lib/forms/configs/general-info-config.ts` - Form configuration
- `apps/web/src/lib/forms/types/general-info-types.ts` - TypeScript types
- `apps/web/src/lib/forms/validation/general-info-schemas.ts` - Zod validation schemas

**Files to Update:**
- `apps/web/src/app/(SignedIn)/generalinfo/page.tsx` - Main page integration
- `apps/web/src/components/forms/multi-step/index.ts` - Export updates if needed

### Integration Points

**TanStack Forms Integration:** [Source: MultiStepForm implementation]
- Form state management handled by MultiStepForm controller
- Field-level validation using `formInstance.useField()`  
- Step-level validation with Zod schemas before navigation

**Storage Integration:** [Source: LocalStorageProvider implementation]
- Automatic persistence with `form-general-info` storage key
- Data restoration on component mount with error handling
- Storage clearing on successful form submission

**UI Integration:** [Source: NavigationControls and ProgressIndicator]
- Consistent navigation controls with existing form patterns
- Progress indication showing current step and completion status
- Responsive design maintaining existing page layout

### Technical Constraints

**Existing Infrastructure Compatibility:**
- Must work with current Next.js App Router structure
- Integrate with existing authentication context
- Follow established component composition patterns
- Maintain responsive design principles

**Performance Requirements:**
- Form initialization should complete within 500ms
- Step navigation should respond within 100ms  
- Auto-save functionality should not impact user experience
- Component re-rendering optimized with proper memoization

**Type Safety Requirements:**
- Full TypeScript support for form configuration and data
- Zod schema validation for runtime type safety
- Generic type constraints for form data structure
- Integration with existing type system

## Testing

### Test File Location
- `apps/web/src/app/(SignedIn)/generalinfo/page.test.tsx` - Page component integration tests
- `apps/web/src/lib/forms/configs/general-info-config.test.ts` - Form configuration tests

### Test Standards
- **Integration Testing:** Verify MultiStepForm integration with page layout preservation
- **Form Configuration Testing:** Validate step definitions, validation schemas, and field mappings  
- **Data Persistence Testing:** Test localStorage integration with save/restore functionality
- **Navigation Testing:** Verify step navigation with validation requirements
- **Accessibility Testing:** Ensure WCAG 2.1 AA compliance with screen reader support

### Testing Framework Requirements
- **React Testing Library:** Component rendering and user interaction testing
- **Vitest:** Test runner with jsdom environment for DOM simulation
- **MSW:** Mock service worker for API interaction testing (if needed)
- **jest-axe:** Automated accessibility testing integration

### Specific Testing Requirements
- **Form Configuration Validation:** Ensure all step configurations are valid and complete
- **Field Registry Integration:** Verify field type mapping works correctly
- **Storage Integration:** Test auto-save and restoration functionality
- **Error Handling:** Validate error boundary and validation feedback display
- **Responsive Design:** Test form behavior across different viewport sizes

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-08-26 | 1.0 | Initial story creation for GeneralInfo Page Integration | Bob (Scrum Master) |

## Dev Agent Record

**Note:** This section will be populated by the development agent during implementation of the GeneralInfo page integration.

### Agent Model Used
*Development agent model and version will be specified during implementation*

### Debug Log References
*Debug log references will be added during implementation if issues arise*

### Completion Notes List
*Implementation completion notes will be documented here*

### File List
*Files created and modified during implementation will be listed here*

## QA Results

*QA review results will be documented here after implementation is complete*
